CREATE PROGRAM afc_add_cp
 DECLARE cptypecd = f8 WITH constant(uar_get_code_by("DISPLAYKEY",13019,"CHARGEPOINTSCHEDULE"))
 DECLARE cpschedule = f8 WITH constant(uar_get_code_by("DISPLAY",14002,"BHS Charge Point"))
 DECLARE chrglevel = f8 WITH constant(uar_get_code_by("DISPLAY",13020,"Group"))
 DECLARE chrgpoint = f8 WITH constant(uar_get_code_by("DISPLAY",13029,"COMPLETE"))
 FREE RECORD cp_cdm
 RECORD cp_cdm(
   1 bill_item_cnt = i4
   1 bill_items[*]
     2 bill_item = f8
 )
 SELECT INTO "nl:"
  FROM bill_item bi
  PLAN (bi
   WHERE bi.bill_item_id IN (5204507, 5203696, 5203695, 5211857, 5212392,
   5212390, 5212391, 5206533, 5201363, 5212395,
   5208035, 5205673, 5205672, 5204290, 5211802,
   5204778, 5207492, 5206598, 5206599, 5206600,
   5206693, 5207227, 5206585, 5206604, 5206605,
   5209362, 5207595, 5211792, 5211793, 5206602,
   5209525, 5206784, 5209401, 5209406, 5211476,
   5212324, 5203707, 5203708, 5206601, 5209369,
   5207811, 5209626, 5201913, 5204258, 5204259,
   5204256, 5204338, 5208962, 5207545, 5207520,
   5205671, 5205667, 5205669, 5203867, 5201006,
   5203869, 5203870, 5204380, 5204379, 5206488,
   5206489, 5206490, 5207600, 5203155, 5204480,
   5208051, 5208049, 5208050, 5208053, 5208048,
   5208052, 5204420, 5204216, 5204218, 5205616,
   5203524, 5203523, 5212406, 5200845, 5200846,
   5200781, 5200782, 5200786, 5200793, 5197228,
   5200796, 5200798, 5200799, 5200794, 5200795,
   5200803, 5200804, 5200805, 5200806, 5200807,
   5200808, 5201375, 5201374, 5201373, 5201647,
   5201352, 5201486, 5197188, 5197180, 5201346,
   5205679, 5205650, 5201359, 5201354, 5202034,
   5201356, 5205648, 5205627, 5197224, 5201357,
   5209227, 5209228, 5209229, 5205678, 5205600,
   5204490, 5204491, 5204492, 5204493, 5204401,
   5204402, 5204403, 5208484, 5208485, 5208430,
   5208486, 5208487, 5203171, 5203157, 5203170,
   5203684, 5203694, 5203151, 5203162, 5203160,
   5203683, 5203158, 5201215, 5204895, 5201227,
   5201226, 5204908, 5204910, 5204896, 5204884,
   5204912, 5204911, 5203689, 5201211, 5205664,
   5203687, 5208378, 5203682, 5204907, 5203686,
   5203688, 5208030, 5202392, 5203690, 5203173,
   5207552, 5207553, 5207554, 5202556, 5203159,
   5202102, 5200844, 5202221, 5202220, 5202219,
   5205548, 5200784, 5200785, 5202398, 5200830,
   5202385, 5202388, 5202390, 5202406, 5202391,
   5202397, 5202396, 5205542, 5207500, 5207501,
   5207502, 5207504, 5204436, 5202195, 5202092,
   5202706, 5202091, 5202380, 5202379, 5202196,
   5203351, 5203123, 5202193, 5200853, 5203115,
   5203109, 5203110, 5203116, 5203117, 5203118,
   5203119, 5203120, 5203111, 5203105, 5203106,
   5202194, 5197114, 5203192, 5203193, 5197115,
   5202197, 5202191, 5202192, 5202336, 5202105,
   5204130, 5202545, 5202542, 5202544, 5202310,
   5202106, 5203336, 5202596, 5202025, 5207503,
   5202355, 5201977, 5201978, 5201979, 5201980,
   5201981, 5201982, 5201983, 5202541, 5202400,
   5202399, 5197239, 5201823, 5207505, 5212339,
   5201821, 5202073, 5201963, 5202026, 5202027,
   5207506, 5201966, 5202243, 5207498, 5207499,
   5207489, 5207508, 5207507, 5207479, 5207478,
   5202072, 5202071, 5201970, 5203326, 5200907,
   5203407, 5203368, 5203317, 5203406, 5203946,
   5203349, 5201316, 5205555, 5200914, 5203319,
   5197178, 5197177, 5200901, 5203346, 5204118,
   5204119, 5203357, 5203288, 5203284, 5203286,
   5203271, 5202040, 5202041, 5202042, 5202043,
   5202044, 5202045, 5202052, 5202038, 5202039,
   5202053, 5207972, 5207973, 5207974, 5207975,
   5207976, 5207977, 5203251, 5203252, 5203253,
   5202036, 5202037, 5203268, 5207978, 5207930,
   5207931, 5207932, 5207933, 5203292, 5203289,
   5203291, 5203293, 5203290, 5204367, 5204368,
   5202055, 5202056, 5202057, 5202058, 5202029,
   5202030, 5202031, 5202032, 5202033, 5203254,
   5203255, 5203256, 5203257, 5203258, 5202054,
   5203299, 5203276, 5207967, 5207968, 5207969,
   5207970, 5207971, 5202046, 5202047, 5202048,
   5202049, 5202050, 5202051, 5203280, 5203282,
   5203279, 5203278, 5207966, 5202651, 5203275,
   5203274, 5203272, 5202060, 5202061, 5202062,
   5202063, 5202064, 5202065, 5201651, 5203506,
   5203505, 5207456, 5207457, 5207458, 5207459,
   5207455, 5207460, 5207461, 5204522, 5202881,
   5203213, 5202880, 5205802, 5205804, 5205805,
   5211506, 5205736, 5207723, 5207286, 5207324,
   5208499, 5208963, 5210848, 5210740, 5212129,
   5203844, 5204061, 5204078, 5212128, 5212824,
   5212825, 5210054, 5210213, 5210280, 5210377,
   5210147, 5210739, 5210477, 5210548, 5210738,
   5210476, 5210547, 5210737, 5207069, 5207086,
   5208658, 5206817, 5207693, 5211607, 5211608,
   5211605, 5211606, 5211609, 5211610, 5211611,
   5211612, 5210830, 5210828, 5210829, 5210826,
   5210827, 5206132, 5204263, 5210843, 5204133,
   5204134, 5204136, 5204137, 5210841, 5210837,
   5210838, 5210839, 5210840, 5210836, 5210831,
   5210832, 5210833, 5210834, 5210835, 5210842,
   5207199, 5208791, 5202766, 5202906, 5202907,
   5202900, 5208678, 5208489, 5202727, 5209928,
   5209927, 5202902, 5209625, 5208382, 5207056,
   5213015, 5213013, 5213016, 5213014, 5213012)
    AND  NOT ( EXISTS (
   (SELECT
    bim.bill_item_id
    FROM bill_item_modifier bim
    WHERE bim.bill_item_id=bi.bill_item_id
     AND bim.key1_id=cpschedule))))
  HEAD REPORT
   cnt = 0
  DETAIL
   cnt = (cnt+ 1), stat = alterlist(cp_cdm->bill_items,cnt), cp_cdm->bill_item_cnt = cnt,
   cp_cdm->bill_items[cnt].bill_item = bi.bill_item_id
  FOOT REPORT
   stat = alterlist(cp_cdm->bill_items,cnt)
  WITH nocounter
 ;end select
 SET sup_bi_cnt = cp_cdm->bill_item_cnt
 SET startcnt = 1
 FOR (loop_counter = startcnt TO sup_bi_cnt)
   FREE RECORD request
   RECORD request(
     1 bill_item_modifier_qual = i2
     1 bill_item_modifier[*]
       2 bill_item_mod_id = f8
       2 bill_item_id = f8
       2 bill_item_type_cd = f8
       2 key1_id = f8
       2 key2_id = f8
       2 key3_id = f8
       2 key4_id = f8
       2 key5_id = f8
       2 key6 = vc
       2 key7 = vc
       2 key8 = vc
       2 key9 = vc
       2 key10 = vc
       2 key11 = vc
       2 key12 = vc
       2 key13 = vc
       2 key14 = vc
       2 key15 = vc
       2 key11_id = f8
       2 key12_id = f8
       2 key13_id = f8
       2 key14_id = f8
       2 key15_id = f8
       2 bim1_int = f8
       2 bim2_int = f8
       2 bim_ind = i2
       2 bim1_ind = i2
       2 bim1_nbr = f8
       2 active_ind_ind = i2
       2 active_ind = i2
       2 active_status_cd = f8
       2 active_status_dt_tm = dq8
       2 active_status_prsnl_id = f8
       2 beg_effective_dt_tm = dq8
       2 end_effective_dt_tm = dq8
   )
   SET request->bill_item_modifier_qual = 1
   SET stat = alterlist(request->bill_item_modifier,1)
   SET request->bill_item_modifier[1].bill_item_type_cd = cptypecd
   SET request->bill_item_modifier[1].key1_id = cpschedule
   SET request->bill_item_modifier[1].key2_id = chrgpoint
   SET request->bill_item_modifier[1].key4_id = chrglevel
   SET request->bill_item_modifier[1].bill_item_id = cp_cdm->bill_items[loop_counter].bill_item
   CALL echo(build("bill_item_id: ",request->bill_item_modifier[1].bill_item_id))
   CALL echo(build("sup_bi bi: ",cp_cdm->bill_items[loop_counter].bill_item))
   CALL echo(build("loop_counter: ",loop_counter))
   SET action_begin = 1
   SET action_end = 1
   EXECUTE afc_add_bill_item_modifier
 ENDFOR
END GO
