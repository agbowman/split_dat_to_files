CREATE PROGRAM bhs_eks_upd_med_service:dba
 FREE RECORD m_erequest
 RECORD m_erequest(
   1 encounter_qual = i4
   1 esi_ensure_type = c3
   1 mode = i2
   1 encntrlochistoverride = i2
   1 encounter[*]
     2 abn_status_cd = f8
     2 expected_delivery_dt_tm = dq8
     2 last_menstrual_period_dt_tm = dq8
     2 onset_dt_tm = dq8
     2 result_acc_dt_tm = dq8
     2 level_of_service_cd = f8
     2 pregnancy_status_cd = f8
     2 mental_health_cd = f8
     2 mental_health_dt_tm = dq8
     2 action_type = c3
     2 new_person = c1
     2 pm_hist_tracking_id = f8
     2 transaction_dt_tm = dq8
     2 transaction_reason_cd = f8
     2 encntr_id = f8
     2 person_id = f8
     2 active_ind_ind = i2
     2 active_ind = i2
     2 active_status_cd = f8
     2 active_status_dt_tm = dq8
     2 active_status_prsnl_id = f8
     2 beg_effective_dt_tm = dq8
     2 end_effective_dt_tm = dq8
     2 encntr_class_cd = f8
     2 encntr_type_cd = f8
     2 encntr_type_class_cd = f8
     2 encntr_status_cd = f8
     2 pre_reg_dt_tm = dq8
     2 pre_reg_prsnl_id = f8
     2 reg_dt_tm = dq8
     2 reg_prsnl_id = f8
     2 est_arrive_dt_tm = dq8
     2 est_depart_dt_tm = dq8
     2 arrive_dt_tm = dq8
     2 depart_dt_tm = dq8
     2 admit_type_cd = f8
     2 admit_src_cd = f8
     2 admit_mode_cd = f8
     2 admit_with_medication_cd = f8
     2 referring_comment = c100
     2 disch_disposition_cd = f8
     2 disch_to_loctn_cd = f8
     2 preadmit_nbr = c100
     2 preadmit_testing_cd = f8
     2 preadmit_testing_list_ind = i2
     2 preadmit_testing[*]
       3 value_cd = f8
     2 readmit_cd = f8
     2 accommodation_cd = f8
     2 accommodation_request_cd = f8
     2 alt_result_dest_cd = f8
     2 ambulatory_cond_cd = f8
     2 courtesy_cd = f8
     2 diet_type_cd = f8
     2 isolation_cd = f8
     2 med_service_cd = f8
     2 result_dest_cd = f8
     2 confid_level_cd = f8
     2 vip_cd = f8
     2 name_last_key = c200
     2 name_first_key = c200
     2 name_full_formatted = c200
     2 name_last = c200
     2 name_first = c200
     2 name_phonetic = c200
     2 sex_cd = f8
     2 birth_dt_cd = f8
     2 birth_dt_tm = dq8
     2 species_cd = f8
     2 data_status_cd = f8
     2 data_status_dt_tm = dq8
     2 data_status_prsnl_id = f8
     2 contributor_system_cd = f8
     2 location_cd = f8
     2 loc_facility_cd = f8
     2 loc_building_cd = f8
     2 loc_nurse_unit_cd = f8
     2 loc_room_cd = f8
     2 loc_bed_cd = f8
     2 disch_dt_tm = dq8
     2 guarantor_type_cd = f8
     2 loc_temp_cd = f8
     2 organization_id = f8
     2 esiorgalias[*]
       3 alias_pool_cd = f8
       3 alias_type_cd = f8
       3 alias = c200
     2 def_organization_id = f8
     2 reason_for_visit = c500
     2 encntr_financial_id = f8
     2 name_first_synonym_id = f8
     2 financial_class_cd = f8
     2 bbd_procedure_cd = f8
     2 info_given_by = c100
     2 safekeeping_cd = f8
     2 trauma_cd = f8
     2 triage_cd = f8
     2 triage_dt_tm = dq8
     2 visitor_status_cd = f8
     2 valuables_cd = f8
     2 valuables_list_ind = i2
     2 valuables[*]
       3 value_cd = f8
     2 security_access_cd = f8
     2 refer_facility_cd = f8
     2 trauma_dt_tm = dq8
     2 accomp_by_cd = f8
     2 accommodation_reason_cd = f8
     2 program_service_cd = f8
     2 specialty_unit_cd = f8
     2 updt_cnt = i4
     2 chart_access_organization_id = f8
     2 chart_complete_dt_tm = dq8
     2 encntr_complete_dt_tm = dq8
     2 zero_balance_dt_tm = dq8
     2 archive_dt_tm_est = dq8
     2 archive_dt_tm_act = dq8
     2 purge_dt_tm_est = dq8
     2 purge_dt_tm_act = dq8
     2 pa_current_status_dt_tm = dq8
     2 pa_current_status_cd = f8
     2 parent_ret_criteria_id = f8
     2 service_category_cd = f8
     2 transaction_dt_tm = dq8
     2 encntr_fin_hist_type_cd = f8
     2 est_length_of_stay = i4
     2 contract_status_cd = f8
     2 attend_prsnl_id = f8
     2 assign_to_loc_dt_tm = dq8
     2 alt_lvl_care_cd = f8
     2 alt_lvl_care_dt_tm = dq8
     2 alc_reason_cd = f8
     2 alc_decomp_dt_tm = dq8
     2 region_cd = f8
     2 sitter_required_cd = f8
     2 doc_rcvd_dt_tm = dq8
     2 referral_rcvd_dt_tm = dq8
     2 place_auth_prsnl_id = f8
     2 patient_classification_cd = f8
     2 mental_category_cd = f8
     2 psychiatric_status_cd = f8
     2 inpatient_admit_dt_tm = dq8
     2 loc_temp_cd = f8
 ) WITH protect
 RECORD ereply(
   1 encounter_qual = i2
   1 encounter[*]
     2 encntr_id = f8
     2 pm_hist_tracking_id = f8
   1 status_data
     2 status = c1
     2 subeventstatus[1]
       3 operationname = c25
       3 operationstatus = c1
       3 targetobjectname = c25
       3 targetobjectvalue = vc
 ) WITH protect
 FREE RECORD m_crequest
 RECORD m_crequest(
   1 pm_hist_tracking_id = f8
   1 transaction_id = f8
   1 transaction = vc
   1 transaction_dt_tm = dq8
   1 hl7_event = vc
   1 person_id = f8
   1 encntr_id = f8
   1 contributor_system_cd = f8
   1 transaction_reason = vc
   1 transaction_reason_cd = f8
   1 task_number = i4
   1 trans
     2 transaction_id = f8
     2 activity_dt_tm = dq8
     2 transaction = c4
     2 n_person_id = f8
     2 o_person_id = f8
     2 n_encntr_id = f8
     2 o_encntr_id = f8
     2 n_encntr_fin_id = f8
     2 o_encntr_fin_id = f8
     2 n_mrn = c20
     2 o_mrn = c20
     2 n_fin_nbr = c20
     2 o_fin_nbr = c20
     2 n_name_last = c20
     2 o_name_last = c20
     2 n_name_first = c20
     2 o_name_first = c20
     2 n_name_middle = c20
     2 o_name_middle = c20
     2 n_name_formatted = c30
     2 o_name_formatted = c30
     2 n_birth_dt_cd = f8
     2 o_birth_dt_cd = f8
     2 n_birth_dt_tm = dq8
     2 o_birth_dt_tm = dq8
     2 n_person_sex_cd = f8
     2 o_person_sex_cd = f8
     2 n_ssn = c15
     2 o_ssn = c15
     2 n_person_type_cd = f8
     2 o_person_type_cd = f8
     2 n_autopsy_cd = f8
     2 o_autopsy_cd = f8
     2 n_conception_dt_tm = dq8
     2 o_conception_dt_tm = dq8
     2 n_cause_of_death = c40
     2 o_cause_of_death = c40
     2 n_deceased_cd = f8
     2 o_deceased_cd = f8
     2 n_deceased_dt_tm = dq8
     2 o_deceased_dt_tm = dq8
     2 n_ethnic_grp_cd = f8
     2 o_ethnic_grp_cd = f8
     2 n_language_cd = f8
     2 o_language_cd = f8
     2 n_marital_type_cd = f8
     2 o_marital_type_cd = f8
     2 n_race_cd = f8
     2 o_race_cd = f8
     2 n_religion_cd = f8
     2 o_religion_cd = f8
     2 n_sex_age_chg_ind_ind = i2
     2 n_sex_age_chg_ind = i2
     2 o_sex_age_chg_ind_ind = i2
     2 o_sex_age_chg_ind = i2
     2 n_lang_dialect_cd = f8
     2 o_lang_dialect_cd = f8
     2 n_species_cd = f8
     2 o_species_cd = f8
     2 n_confid_level_cd = f8
     2 o_confid_level_cd = f8
     2 n_person_vip_cd = f8
     2 o_person_vip_cd = f8
     2 n_citizenship_cd = f8
     2 o_citizenship_cd = f8
     2 n_vet_mil_stat_cd = f8
     2 o_vet_mil_stat_cd = f8
     2 n_mthr_maid_name = c20
     2 o_mthr_maid_name = c20
     2 n_nationality_cd = f8
     2 o_nationality_cd = f8
     2 n_encntr_class_cd = f8
     2 o_encntr_class_cd = f8
     2 n_encntr_type_cd = f8
     2 o_encntr_type_cd = f8
     2 n_encntr_type_class_cd = f8
     2 o_encntr_type_class_cd = f8
     2 n_encntr_status_cd = f8
     2 o_encntr_status_cd = f8
     2 n_pre_reg_dt_tm = dq8
     2 o_pre_reg_dt_tm = dq8
     2 n_pre_reg_prsnl_id = f8
     2 o_pre_reg_prsnl_id = f8
     2 n_reg_dt_tm = dq8
     2 o_reg_dt_tm = dq8
     2 n_reg_prsnl_id = f8
     2 o_reg_prsnl_id = f8
     2 n_est_arrive_dt_tm = dq8
     2 o_est_arrive_dt_tm = dq8
     2 n_est_depart_dt_tm = dq8
     2 o_est_depart_dt_tm = dq8
     2 n_arrive_dt_tm = dq8
     2 o_arrive_dt_tm = dq8
     2 n_depart_dt_tm = dq8
     2 o_depart_dt_tm = dq8
     2 n_admit_type_cd = f8
     2 o_admit_type_cd = f8
     2 n_admit_src_cd = f8
     2 o_admit_src_cd = f8
     2 n_admit_mode_cd = f8
     2 o_admit_mode_cd = f8
     2 n_admit_with_med_cd = f8
     2 o_admit_with_med_cd = f8
     2 n_refer_comment = c40
     2 o_refer_comment = c40
     2 n_disch_disp_cd = f8
     2 o_disch_disp_cd = f8
     2 n_disch_to_loctn_cd = f8
     2 o_disch_to_loctn_cd = f8
     2 n_preadmit_nbr = c20
     2 o_preadmit_nbr = c20
     2 n_preadmit_test_cd = f8
     2 o_preadmit_test_cd = f8
     2 n_readmit_cd = f8
     2 o_readmit_cd = f8
     2 n_accom_cd = f8
     2 o_accom_cd = f8
     2 n_accom_req_cd = f8
     2 o_accom_req_cd = f8
     2 n_alt_result_dest_cd = f8
     2 o_alt_result_dest_cd = f8
     2 n_amb_cond_cd = f8
     2 o_amb_cond_cd = f8
     2 n_courtesy_cd = f8
     2 o_courtesy_cd = f8
     2 n_diet_type_cd = f8
     2 o_diet_type_cd = f8
     2 n_isolation_cd = f8
     2 o_isolation_cd = f8
     2 n_med_service_cd = f8
     2 o_med_service_cd = f8
     2 n_result_dest_cd = f8
     2 o_result_dest_cd = f8
     2 n_encntr_vip_cd = f8
     2 o_encntr_vip_cd = f8
     2 n_encntr_sex_cd = f8
     2 o_encntr_sex_cd = f8
     2 n_disch_dt_tm = dq8
     2 o_disch_dt_tm = dq8
     2 n_guar_type_cd = f8
     2 o_guar_type_cd = f8
     2 n_loc_temp_cd = f8
     2 o_loc_temp_cd = f8
     2 n_reason_for_visit = c40
     2 o_reason_for_visit = c40
     2 n_fin_class_cd = f8
     2 o_fin_class_cd = f8
     2 n_location_cd = f8
     2 o_location_cd = f8
     2 n_loc_facility_cd = f8
     2 o_loc_facility_cd = f8
     2 n_loc_building_cd = f8
     2 o_loc_building_cd = f8
     2 n_loc_nurse_unit_cd = f8
     2 o_loc_nurse_unit_cd = f8
     2 n_loc_room_cd = f8
     2 o_loc_room_cd = f8
     2 n_loc_bed_cd = f8
     2 o_loc_bed_cd = f8
     2 n_admit_doc_name = c30
     2 o_admit_doc_name = c30
     2 n_admit_doc_id = f8
     2 o_admit_doc_id = f8
     2 n_attend_doc_name = c30
     2 o_attend_doc_name = c30
     2 n_attend_doc_id = f8
     2 o_attend_doc_id = f8
     2 n_consult_doc_name = c30
     2 o_consult_doc_name = c30
     2 n_consult_doc_id = f8
     2 o_consult_doc_id = f8
     2 n_refer_doc_name = c30
     2 o_refer_doc_name = c30
     2 n_refer_doc_id = f8
     2 o_refer_doc_id = f8
     2 n_admit_doc_nbr = c16
     2 o_admit_doc_nbr = c16
     2 n_attend_doc_nbr = c16
     2 o_attend_doc_nbr = c16
     2 n_consult_doc_nbr = c16
     2 o_consult_doc_nbr = c16
     2 n_refer_doc_nbr = c16
     2 o_refer_doc_nbr = c16
     2 n_per_home_address_id = f8
     2 o_per_home_address_id = f8
     2 n_per_home_addr_street = c100
     2 o_per_home_addr_street = c100
     2 n_per_home_addr_city = c40
     2 o_per_home_addr_city = c40
     2 n_per_home_addr_state = c20
     2 o_per_home_addr_state = c20
     2 n_per_home_addr_zipcode = c20
     2 o_per_home_addr_zipcode = c20
     2 n_per_bus_address_id = f8
     2 o_per_bus_address_id = f8
     2 n_per_bus_addr_street = c100
     2 o_per_bus_addr_street = c100
     2 n_per_bus_addr_city = c40
     2 o_per_bus_addr_city = c40
     2 n_per_bus_addr_state = c20
     2 o_per_bus_addr_state = c20
     2 n_per_bus_addr_zipcode = c20
     2 o_per_bus_addr_zipcode = c20
     2 n_per_home_phone_id = f8
     2 o_per_home_phone_id = f8
     2 n_per_home_ph_format_cd = f8
     2 o_per_home_ph_format_cd = f8
     2 n_per_home_ph_number = c20
     2 o_per_home_ph_number = c20
     2 n_per_home_ext = c10
     2 o_per_home_ext = c10
     2 n_per_bus_phone_id = f8
     2 o_per_bus_phone_id = f8
     2 n_per_bus_ph_format_cd = f8
     2 o_per_bus_ph_format_cd = f8
     2 n_per_bus_ph_number = c20
     2 o_per_bus_ph_number = c20
     2 n_per_bus_ext = c10
     2 o_per_bus_ext = c10
     2 n_per_home_addr_street2 = c100
     2 o_per_home_addr_street2 = c100
     2 n_per_bus_addr_street2 = c100
     2 o_per_bus_addr_street2 = c100
     2 n_per_home_addr_county = c20
     2 o_per_home_addr_county = c20
     2 n_per_home_addr_country = c20
     2 o_per_home_addr_country = c20
     2 n_per_bus_addr_county = c20
     2 o_per_bus_addr_county = c20
     2 n_per_bus_addr_country = c20
     2 o_per_bus_addr_country = c20
     2 n_encntr_complete_dt_tm = dq8
     2 o_encntr_complete_dt_tm = dq8
     2 n_organization_id = f8
     2 o_organization_id = f8
     2 n_contributor_system_cd = f8
     2 o_contributor_system_cd = f8
     2 hl7_event = c10
     2 n_assign_to_loc_dt_tm = dq8
     2 o_assign_to_loc_dt_tm = dq8
     2 n_alt_lvl_care_cd = f8
     2 o_alt_lvl_care_cd = f8
     2 n_program_service_cd = f8
     2 o_program_service_cd = f8
     2 n_specialty_unit_cd = f8
     2 o_specialty_unit_cd = f8
     2 n_birth_tz = i4
     2 o_birth_tz = i4
     2 abs_n_birth_dt_tm = dq8
     2 abs_o_birth_dt_tm = dq8
     2 n_service_category_cd = f8
     2 o_service_category_cd = f8
 )
 RECORD creply(
   1 trans
     2 transaction_id = f8
     2 pm_hist_tracking_id = f8
     2 activity_dt_tm = dq8
     2 transaction_dt_tm = dq8
     2 transaction = c4
     2 n_person_id = f8
     2 o_person_id = f8
     2 n_encntr_id = f8
     2 o_encntr_id = f8
     2 n_encntr_fin_id = f8
     2 o_encntr_fin_id = f8
     2 n_mrn = c20
     2 o_mrn = c20
     2 n_fin_nbr = c20
     2 o_fin_nbr = c20
     2 n_name_last = c20
     2 o_name_last = c20
     2 n_name_first = c20
     2 o_name_first = c20
     2 n_name_middle = c20
     2 o_name_middle = c20
     2 n_name_formatted = c30
     2 o_name_formatted = c30
     2 n_birth_dt_cd = f8
     2 o_birth_dt_cd = f8
     2 n_birth_dt_tm = dq8
     2 o_birth_dt_tm = dq8
     2 n_person_sex_cd = f8
     2 o_person_sex_cd = f8
     2 n_ssn = c15
     2 o_ssn = c15
     2 n_person_type_cd = f8
     2 o_person_type_cd = f8
     2 n_autopsy_cd = f8
     2 o_autopsy_cd = f8
     2 n_conception_dt_tm = dq8
     2 o_conception_dt_tm = dq8
     2 n_cause_of_death = c40
     2 o_cause_of_death = c40
     2 n_deceased_cd = f8
     2 o_deceased_cd = f8
     2 n_deceased_dt_tm = dq8
     2 o_deceased_dt_tm = dq8
     2 n_ethnic_grp_cd = f8
     2 o_ethnic_grp_cd = f8
     2 n_language_cd = f8
     2 o_language_cd = f8
     2 n_marital_type_cd = f8
     2 o_marital_type_cd = f8
     2 n_race_cd = f8
     2 o_race_cd = f8
     2 n_religion_cd = f8
     2 o_religion_cd = f8
     2 n_sex_age_chg_ind_ind = i2
     2 n_sex_age_chg_ind = i2
     2 o_sex_age_chg_ind_ind = i2
     2 o_sex_age_chg_ind = i2
     2 n_lang_dialect_cd = f8
     2 o_lang_dialect_cd = f8
     2 n_species_cd = f8
     2 o_species_cd = f8
     2 n_confid_level_cd = f8
     2 o_confid_level_cd = f8
     2 n_person_vip_cd = f8
     2 o_person_vip_cd = f8
     2 n_citizenship_cd = f8
     2 o_citizenship_cd = f8
     2 n_vet_mil_stat_cd = f8
     2 o_vet_mil_stat_cd = f8
     2 n_mthr_maid_name = c20
     2 o_mthr_maid_name = c20
     2 n_nationality_cd = f8
     2 o_nationality_cd = f8
     2 n_encntr_class_cd = f8
     2 o_encntr_class_cd = f8
     2 n_encntr_type_cd = f8
     2 o_encntr_type_cd = f8
     2 n_encntr_type_class_cd = f8
     2 o_encntr_type_class_cd = f8
     2 n_encntr_status_cd = f8
     2 o_encntr_status_cd = f8
     2 n_pre_reg_dt_tm = dq8
     2 o_pre_reg_dt_tm = dq8
     2 n_pre_reg_prsnl_id = f8
     2 o_pre_reg_prsnl_id = f8
     2 n_reg_dt_tm = dq8
     2 o_reg_dt_tm = dq8
     2 n_reg_prsnl_id = f8
     2 o_reg_prsnl_id = f8
     2 n_est_arrive_dt_tm = dq8
     2 o_est_arrive_dt_tm = dq8
     2 n_est_depart_dt_tm = dq8
     2 o_est_depart_dt_tm = dq8
     2 n_arrive_dt_tm = dq8
     2 o_arrive_dt_tm = dq8
     2 n_depart_dt_tm = dq8
     2 o_depart_dt_tm = dq8
     2 n_admit_type_cd = f8
     2 o_admit_type_cd = f8
     2 n_admit_src_cd = f8
     2 o_admit_src_cd = f8
     2 n_admit_mode_cd = f8
     2 o_admit_mode_cd = f8
     2 n_admit_with_med_cd = f8
     2 o_admit_with_med_cd = f8
     2 n_refer_comment = c40
     2 o_refer_comment = c40
     2 n_disch_disp_cd = f8
     2 o_disch_disp_cd = f8
     2 n_disch_to_loctn_cd = f8
     2 o_disch_to_loctn_cd = f8
     2 n_preadmit_nbr = c20
     2 o_preadmit_nbr = c20
     2 n_preadmit_test_cd = f8
     2 o_preadmit_test_cd = f8
     2 n_readmit_cd = f8
     2 o_readmit_cd = f8
     2 n_accom_cd = f8
     2 o_accom_cd = f8
     2 n_accom_req_cd = f8
     2 o_accom_req_cd = f8
     2 n_alt_result_dest_cd = f8
     2 o_alt_result_dest_cd = f8
     2 n_amb_cond_cd = f8
     2 o_amb_cond_cd = f8
     2 n_courtesy_cd = f8
     2 o_courtesy_cd = f8
     2 n_diet_type_cd = f8
     2 o_diet_type_cd = f8
     2 n_isolation_cd = f8
     2 o_isolation_cd = f8
     2 n_med_service_cd = f8
     2 o_med_service_cd = f8
     2 n_result_dest_cd = f8
     2 o_result_dest_cd = f8
     2 n_encntr_vip_cd = f8
     2 o_encntr_vip_cd = f8
     2 n_encntr_sex_cd = f8
     2 o_encntr_sex_cd = f8
     2 n_disch_dt_tm = dq8
     2 o_disch_dt_tm = dq8
     2 n_guar_type_cd = f8
     2 o_guar_type_cd = f8
     2 n_loc_temp_cd = f8
     2 o_loc_temp_cd = f8
     2 n_reason_for_visit = c40
     2 o_reason_for_visit = c40
     2 n_fin_class_cd = f8
     2 o_fin_class_cd = f8
     2 n_location_cd = f8
     2 o_location_cd = f8
     2 n_loc_facility_cd = f8
     2 o_loc_facility_cd = f8
     2 n_loc_building_cd = f8
     2 o_loc_building_cd = f8
     2 n_loc_nurse_unit_cd = f8
     2 o_loc_nurse_unit_cd = f8
     2 n_loc_room_cd = f8
     2 o_loc_room_cd = f8
     2 n_loc_bed_cd = f8
     2 o_loc_bed_cd = f8
     2 n_admit_doc_name = c30
     2 o_admit_doc_name = c30
     2 n_admit_doc_id = f8
     2 o_admit_doc_id = f8
     2 n_attend_doc_name = c30
     2 o_attend_doc_name = c30
     2 n_attend_doc_id = f8
     2 o_attend_doc_id = f8
     2 n_consult_doc_name = c30
     2 o_consult_doc_name = c30
     2 n_consult_doc_id = f8
     2 o_consult_doc_id = f8
     2 n_refer_doc_name = c30
     2 o_refer_doc_name = c30
     2 n_refer_doc_id = f8
     2 o_refer_doc_id = f8
     2 n_admit_doc_nbr = c16
     2 o_admit_doc_nbr = c16
     2 n_attend_doc_nbr = c16
     2 o_attend_doc_nbr = c16
     2 n_consult_doc_nbr = c16
     2 o_consult_doc_nbr = c16
     2 n_refer_doc_nbr = c16
     2 o_refer_doc_nbr = c16
     2 n_per_home_address_id = f8
     2 o_per_home_address_id = f8
     2 n_per_home_addr_street = c100
     2 o_per_home_addr_street = c100
     2 n_per_home_addr_city = c40
     2 o_per_home_addr_city = c40
     2 n_per_home_addr_state = c20
     2 o_per_home_addr_state = c20
     2 n_per_home_addr_zipcode = c20
     2 o_per_home_addr_zipcode = c20
     2 n_per_bus_address_id = f8
     2 o_per_bus_address_id = f8
     2 n_per_bus_addr_street = c100
     2 o_per_bus_addr_street = c100
     2 n_per_bus_addr_city = c40
     2 o_per_bus_addr_city = c40
     2 n_per_bus_addr_state = c20
     2 o_per_bus_addr_state = c20
     2 n_per_bus_addr_zipcode = c20
     2 o_per_bus_addr_zipcode = c20
     2 n_per_home_phone_id = f8
     2 o_per_home_phone_id = f8
     2 n_per_home_ph_format_cd = f8
     2 o_per_home_ph_format_cd = f8
     2 n_per_home_ph_number = c20
     2 o_per_home_ph_number = c20
     2 n_per_home_ext = c10
     2 o_per_home_ext = c10
     2 n_per_bus_phone_id = f8
     2 o_per_bus_phone_id = f8
     2 n_per_bus_ph_format_cd = f8
     2 o_per_bus_ph_format_cd = f8
     2 n_per_bus_ph_number = c20
     2 o_per_bus_ph_number = c20
     2 n_per_bus_ext = c10
     2 o_per_bus_ext = c10
     2 n_per_home_addr_street2 = c100
     2 o_per_home_addr_street2 = c100
     2 n_per_bus_addr_street2 = c100
     2 o_per_bus_addr_street2 = c100
     2 n_per_home_addr_county = c20
     2 o_per_home_addr_county = c20
     2 n_per_home_addr_country = c20
     2 o_per_home_addr_country = c20
     2 n_per_bus_addr_county = c20
     2 o_per_bus_addr_county = c20
     2 n_per_bus_addr_country = c20
     2 o_per_bus_addr_country = c20
     2 n_encntr_complete_dt_tm = dq8
     2 o_encntr_complete_dt_tm = dq8
     2 n_organization_id = f8
     2 o_organization_id = f8
     2 n_contributor_system_cd = f8
     2 o_contributor_system_cd = f8
     2 n_assign_to_loc_dt_tm = dq8
     2 o_assign_to_loc_dt_tm = dq8
     2 n_alt_lvl_care_cd = f8
     2 o_alt_lvl_care_cd = f8
     2 n_program_service_cd = f8
     2 o_program_service_cd = f8
     2 n_specialty_unit_cd = f8
     2 o_specialty_unit_cd = f8
     2 n_birth_tz = i4
     2 o_birth_tz = i4
     2 abs_n_birth_dt_tm = dq8
     2 abs_o_birth_dt_tm = dq8
     2 n_service_category_cd = f8
     2 o_service_category_cd = f8
     2 output_dest_cd = f8
     2 process_slice_ind = i2
     2 process_post_doc_ind = i2
   1 status_data
     2 status = c1
     2 subeventstatus[1]
       3 operationname = c25
       3 operationstatus = c1
       3 targetobjectname = c25
       3 targetobjectvalue = vc
 )
 DECLARE mf_admintriage_cd = f8 WITH public, noconstant(0.00)
 DECLARE mn_continue_ind = i2 WITH protect, noconstant(0)
 DECLARE log_message = vc
 SET retval = - (1)
 SET log_message = concat("Script failed.")
 SELECT INTO "nl:"
  FROM code_value cv
  PLAN (cv
   WHERE cv.code_set=34
    AND cv.display_key="ADMINTRIAGE"
    AND cv.active_ind=1
    AND cv.end_effective_dt_tm > cnvtdatetime(curdate,curtime))
  ORDER BY cv.begin_effective_dt_tm DESC
  HEAD REPORT
   mf_admintriage_cd = cv.code_value
  WITH nocounter
 ;end select
 SELECT INTO "nl:"
  FROM encounter e
  PLAN (e
   WHERE e.encntr_id=link_encntrid
    AND e.active_ind=1
    AND e.end_effective_dt_tm > cnvtdatetime(curdate,curtime))
  HEAD REPORT
   IF (e.med_service_cd != mf_admintriage_cd)
    mn_continue_ind = 1
   ELSE
    mn_continue_ind = 0
   ENDIF
  WITH nocounter
 ;end select
 IF (mn_continue_ind=0)
  SET retval = 0
  SET log_message = "Med Service for this encounter has already been defined - no change made"
  GO TO exit_script
 ENDIF
 CALL echo("****** set m_erequest record ******")
 SET reqinfo->updt_id = 1.00
 SET m_erequest->encounter_qual = 1
 SET m_erequest->esi_ensure_type = ""
 SET m_erequest->mode = 1
 SET stat = alterlist(m_erequest->encounter,1)
 SET m_erequest->encounter[1].encntr_id = link_encntrid
 SET m_erequest->encounter[1].med_service_cd = mf_admintriage_cd
 CALL echo("****** call pm_upt_encounter script - beg ******")
 EXECUTE pm_upt_encounter  WITH replace(request,m_erequest), replace(reply,ereply)
 COMMIT
 CALL echo("****** call pm_upt_encounter script - end ******")
 IF ((ereply->status_data.status="S"))
  SET reqinfo->updt_id = 1.00
  SET retval = 100
  SET log_message = "Medical Service updated to Admin Triage on encounter"
  CALL echo("****** set m_crequest record ******")
  SET m_crequest->transaction_id = 0.00
  SET m_crequest->transaction_dt_tm = cnvtdatetime(curdate,curtime)
  SET m_crequest->transaction = "UPDT"
  SET m_crequest->transaction_reason = "Update Medical Service on Between Visit Encounter"
  SET m_crequest->person_id = link_personid
  SET m_crequest->encntr_id = link_encntrid
  SET m_crequest->trans.o_med_service_cd = 0.00
  SET m_crequest->trans.n_med_service_cd = mf_admintriage_cd
  CALL echo("****** call pm_ens_transaction script - beg ******")
  EXECUTE pm_ens_transaction  WITH replace(request,m_crequest), replace(reply,creply)
  CALL echo("****** call pm_ens_transaction script - end ******")
  COMMIT
  IF ((creply->trans.transaction_id > 0))
   SET reqinfo->updt_id = 1.00
   SET m_crequest->transaction_id = creply->trans.transaction_id
   SET m_crequest->transaction_dt_tm = cnvtdatetime(curdate,curtime)
   SET m_crequest->transaction = "UPDT"
   SET m_crequest->transaction_reason = "Update Medical Service on Between Visit Encounter"
   SET m_crequest->person_id = link_personid
   SET m_crequest->encntr_id = link_encntrid
   SET m_crequest->trans.o_med_service_cd = 0.00
   SET m_crequest->trans.n_med_service_cd = mf_admintriage_cd
   EXECUTE pm_ens_transaction  WITH replace(request,m_crequest), replace(reply,creply)
   COMMIT
  ENDIF
 ELSE
  SET retval = 0
  SET log_message = "Medical Service NOT updated to Admin Triage on encounter"
  SET log_encntrid = link_encntrid
  SET log_personid = link_personid
 ENDIF
#exit_script
END GO
